% The project

\chapter{The project}
\label{project}
This chapter describes the general setup, its components and a small overview on the tools used for develop the project. Finally the project is explained.

%----------------------------------------------------------------------------------------

\section{Setup overview}
The \kuka{} redundant manipulator is programmed using the KUKA's Sunrise Workbench platform and its Java API's. The usage of an open source stack compatible with ROS allows the usage of the robot in a simple way. 

A Sunrise project, containing one or more Robotic Application can be synchronized to the robot cabinet and executed from the SmartPad. 

The \textit{iiwa stack} provide a Robotic Application that can be used with the robot. It establishes a connection to machines connected via Ethernet to the robot cabinet via ROS. The machine, with ROS installed, will be able to send and receive ROS messages to and from the Robotic Application. The messages used in this stack are taken from the messages available in a standard ROS distribution, but there are other custom ones inside the \texttt{iiwa\_msgs} folder. 

With the stack is simple to manipulate the messages received from the robot and send new ones as command to it, using Python script or ROS functionalities already implemented as services, topics, actions.

\begin{figure}[H]
	\centering
	\includegraphics[scale=0.6]{ros_sunrise.png}
	\caption{Robot control via ROS using \textit{iiwa\_stack} and Sunrise OS}
	\label{ros_sunire}
\end{figure}

For further information about \textit{iiwa\_stack} see \cite{iiwa-stack-link} and the related work \cite{iiwa-stack-paper}. Instead for information about Sunrise OS and Workbench see \cite{thesis}.


	\subsection{KUKA Robot Controller}
	The \kuka{} is controlled via the KUKA Robot Controller, also known as the KUKA Sunrise Cabinet. The KRC is responsible for the transmission control inputs as well as the reading the data of the integrated sensors. In our case, for controlling the Kuka we use the Java application providede by the stack that runs into the SmartPad.

	\subsection{Sunrise.Workbench}
	The Sunrise.Workbench is a tool used to program robot applications in Java, which are loaded into and are executed on the KRC. It offers the possibility to control the robot with the following strategies: position control, velocity control, joint and cartesian impedance control.
	It can also can execute the commonly motion patterns as: spline, point-to-point, linear and circular motions.
	
	Since we have a gripper mounted on media flange, there's a task always active in background that provides a method that can be called via \texttt{ros\_service} to open and close the two jaw. We also have another background task for the \textit{rgb} led present on media flange.

	\subsection{Safety configuration}
	A correct thing to do before start the using of the robot is to check and modify the safety configuration loaded by default. In my case:
	\begin{itemize}
		\item I had to set a new value for every joint in robot configuration. I restrict the value about $ 2 $ degrees.
		\item moreover I added a protected workspace. In this case the robot never goes inside the constraint area.  
	\end{itemize}
	
	
\section{Project implementation}
\label{project-implementation}
As described in section~\ref{goals}, the goal of the thesis was to \ldots % TODO

Staring from the goal, the work was divide into two phases:
\begin{enumerate}
	\item create the mode relative to teach by demonstration, 
	\item create a way to tele-operate the robot in a simple way. 
\end{enumerate}
As described in the next sections, in every phase a way to save waypoints and an action on the gripper was implemented. After that the action was captured by the script and was saved in an \texttt{.csv} file. With a dedicated program and that file, all the actions saved into the file can be replicated by the robot. Then the description of the two developed modalities.

	\subsection{Theach by demonstration}
	\label{teach}
	As described in section \ref{kinestetich-teaching}, teach by demonstration or also called \textit{kinestethic teaching} is a way to move the robot in gravity compensation mode. Using the \textit{iiwa\_stack}, the gravity compensation mode was implemented using a joint impendance control mode where for every joint in robot configuration a stiffness and damping value is setted. Stiffness value must be grater than $ 0 $ and it is expressed in $ Nm/rad $, instead damping value must be between $ 0 $ and $ 1 $. After changing the control mode to joint impendance, the robot seems falls. A force contrary to the gravity must be carried out to keep it up.
	
	On the mediaflange, the green button was dedicated for saving actions on gripper and waypoints.
	
	
	\begin{figure}[H]
		\centering
		\includegraphics[scale=0.8]{media_flange.png}
		\caption{The Mediaflange: $ (1) $ led strip, \\$ (2) $ enabling switch, $ (3) $ application button}
		\label{ros_sunire}
	\end{figure}

	% no apertura gripper perch√® ci sono le mani di mezzo
	% led
	
	\subsection{Teleoperation}
	\label{teleoperation-pad}
	% full task space + joint space	
		